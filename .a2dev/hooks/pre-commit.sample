#!/usr/bin/env sh
# A2Dev pre-commit sample hook
# Copy to .git/hooks/pre-commit and `chmod +x .git/hooks/pre-commit`

set -e
echo "[A2Dev] pre-commit checks: gitleaks + semgrep"

# Secrets scan (staged)
if command -v gitleaks >/dev/null 2>&1; then
  echo "- gitleaks: scanning staged changes"
  gitleaks protect --staged --redact --no-banner --log-opts="" || {
    echo "[A2Dev] gitleaks found potential secrets. Commit aborted." >&2
    exit 1
  }
else
  echo "- gitleaks: not installed; skipping"
fi

# Static analysis (quick)
if command -v semgrep >/dev/null 2>&1; then
  echo "- semgrep: quick scan"
  semgrep --config auto --error --quiet || {
    echo "[A2Dev] semgrep found issues. Commit aborted." >&2
    exit 1
  }
else
  echo "- semgrep: not installed; skipping"
fi

echo "[A2Dev] pre-commit checks: OK"

